<div class="article-versions" style="background-color: #fafafa; padding: 1.5rem; border-radius: 5px; margin-top: 2rem; border: 1px solid #eee;">
  
  {% assign current_slug = page.slug %}
  {% assign base_slug = current_slug %}
  {% assign is_variant = false %}

  {% if current_slug contains "-transcription_" %}
    {% assign is_variant = true %}
    {% assign parts = current_slug | split: "-transcription_" %}
    {% assign base_slug = parts[0] %}
  {% elsif current_slug contains "-transcript_" %}
    {% assign is_variant = true %}
    {% assign parts = current_slug | split: "-transcript_" %}
    {% assign base_slug = parts[0] %}
  {% elsif current_slug contains "-translation_" %}
    {% assign is_variant = true %}
    {% assign parts = current_slug | split: "-translation_" %}
    {% assign base_slug = parts[0] %}
  {% endif %}


  {% if is_variant == true %}
    {% assign original = site.posts | where: "slug", base_slug | first %}
    {% if original %}
      <p style="margin-bottom: 0;">
        <strong>&larr; Return to Original:</strong> <a href="{{ original.url | relative_url }}">{{ original.title }}</a>
      </p>
    {% endif %}
  

  {% else %}

    {% capture internal_transcripts %}
      {% for post in site.posts %}
        {% if post.slug contains base_slug and post.slug != base_slug %}
            
            {% if post.slug contains "-transcription_" %}
                {% assign lang_code = post.slug | split: "-transcription_" | last %}
                <li><a href="{{ post.url | relative_url }}">Transcription ({{ lang_code | upcase }})</a></li>
            
            {% elsif post.slug contains "-transcript_" %}
                {% assign lang_code = post.slug | split: "-transcript_" | last %}
                <li><a href="{{ post.url | relative_url }}">Transcription ({{ lang_code | upcase }})</a></li>
            {% endif %}

        {% endif %}
      {% endfor %}
    {% endcapture %}

    {% capture ext_transcripts %}
      {% if page.external_transcripts %}
        {% for item in page.external_transcripts %}
          <li>
            <a href="{{ item.url }}" target="_blank">{{ item.label }} &#8599;</a>
            {% if item.note %}
              <span style="color: #666; font-style: italic; font-size: 0.9em;"> — {{ item.note }}</span>
            {% endif %}
          </li>
        {% endfor %}
      {% endif %}
    {% endcapture %}

    {% capture internal_translations %}
      {% for post in site.posts %}
        {% if post.slug contains base_slug and post.slug contains "-translation_" %}
           {% assign lang_code = post.slug | split: "-translation_" | last %}
           <li><a href="{{ post.url | relative_url }}">Translation ({{ lang_code | upcase }})</a></li>
        {% endif %}
      {% endfor %}
    {% endcapture %}

    {% capture ext_translations %}
      {% if page.external_translations %}
        {% for item in page.external_translations %}
          <li>
            <a href="{{ item.url }}" target="_blank">{{ item.label }} &#8599;</a>
            {% if item.note %}
              <span style="color: #666; font-style: italic; font-size: 0.9em;"> — {{ item.note }}</span>
            {% endif %}
          </li>
        {% endfor %}
      {% endif %}
    {% endcapture %}

    {% if internal_transcripts contains "<li>" or ext_transcripts contains "<li>" %}
      <p style="margin-bottom: 0.5rem;"><strong>Transcripts available:</strong></p>
      <ul style="margin-top: 0;">
        {{ internal_transcripts }}
        {{ ext_transcripts }}
      </ul>
    {% endif %}

    {% if internal_translations contains "<li>" or ext_translations contains "<li>" %}
      <p style="margin-bottom: 0.5rem;"><strong>Translations available:</strong></p>
      <ul style="margin-top: 0;">
        {{ internal_translations }}
        {{ ext_translations }}
      </ul>
    {% endif %}

  {% endif %}
</div>