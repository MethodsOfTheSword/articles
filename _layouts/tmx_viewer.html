---
layout: default
---
<article class="post-container tmx-viewer">

    <div class="back-nav">
        <a href="{{ '/' | relative_url }}">&larr; Back to Archives</a>
    </div>

    <div class="badge-wrap">
        <span class="badge badge-parallel">Parallel Text</span>
    </div>
    <h1>{{ page.title }}</h1>
    
    {% if page.subtitle %}
        <p class="post-meta">{{ page.date | date: "%d %B %Y" }} â€¢ {{ page.subtitle }}</p>
    {% endif %}

    <div class="source-bar">
        <strong class="source-label">Source:</strong>
        <a href="{{ '/assets/sources/' | relative_url }}{{ page.tmx_filename }}" download class="source-link">
            ðŸ’¾ Download Raw TMX
        </a>
    </div>

    <div id="loading-msg" class="loading-msg">
        Loading translation memory...
    </div>

    <div id="tmx-grid" class="tmx-container">
        <div class="tmx-header">
            <div class="tmx-col-head">{{ page.source_label }}</div>
            <div class="tmx-col-head">{{ page.target_label }}</div>
        </div>
        </div>

    {% include version_links.html %}

</article>

<script>
document.addEventListener("DOMContentLoaded", function() {
    
    // 1. Config from Front Matter
    const tmxUrl = "{{ '/assets/sources/' | relative_url }}{{ page.tmx_filename }}";
    const srcCode = "{{ page.source_lang_code }}"; 
    const tgtCode = "{{ page.target_lang_code }}";

    // Debug Log
    console.log("Fetching TMX from:", tmxUrl);

    // 2. Identify HTML Elements (Crucial Step)
    const grid = document.getElementById("tmx-grid");
    const msgContainer = document.getElementById("loading-msg");

    if (!grid || !msgContainer) {
        console.error("HTML Mismatch: Could not find 'tmx-grid' or 'loading-msg' divs.");
        return;
    }

    fetch(tmxUrl)
        .then(response => {
            if (!response.ok) throw new Error("File not found (404)");
            return response.text();
        })
        .then(str => {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(str, "text/xml");
            
            // Check for XML parsing errors
            if (xmlDoc.querySelector("parsererror")) {
                throw new Error("Invalid XML format.");
            }
            
            const body = xmlDoc.getElementsByTagName("body")[0];
            if (!body) throw new Error("TMX file has no <body> tag.");

            const tus = body.getElementsByTagName("tu");
            console.log(`Found ${tus.length} translation units.`);

            // Loop through Translation Units
            for (let i = 0; i < tus.length; i++) {
                let tu = tus[i];
                let tuvs = tu.getElementsByTagName("tuv");
                let srcText = ""; // Default empty
                let tgtText = "";

                // Find the languages
                for (let j = 0; j < tuvs.length; j++) {
                    let lang = tuvs[j].getAttribute("xml:lang");
                    let seg = tuvs[j].getElementsByTagName("seg")[0];
                    let text = seg ? seg.textContent : "";

                    // Safe match (case insensitive)
                    if (lang && lang.toLowerCase().includes(srcCode.toLowerCase())) srcText = text;
                    if (lang && lang.toLowerCase().includes(tgtCode.toLowerCase())) tgtText = text;
                }

                // If source text is missing, it might be a formatting tag, skip or show placeholder
                if (!srcText && !tgtText) continue; 

                // Create Row
                let row = document.createElement("div");
                row.className = "tmx-row";
                row.innerHTML = `
                    <div class="tmx-cell source">${srcText}</div>
                    <div class="tmx-cell target">${tgtText}</div>
                `;
                grid.appendChild(row);
            }

            // Show Grid, Hide Loader
            msgContainer.style.display = "none";
            grid.style.display = "block";
        })
        .catch(err => {
            console.error(err);
            msgContainer.style.color = "red";
            msgContainer.innerHTML = "Error: " + err.message;
        });
});
</script>

<style>
    /* Grid Container */
    .tmx-container {
        border-top: 2px solid #8b0000;
        font-family: "Georgia", serif;
    }

    /* Sticky Headers */
    .tmx-header {
        display: grid;
        grid-template-columns: 1fr 1fr;
        position: sticky;
        top: 0;
        background: white;
        border-bottom: 1px solid #ccc;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        z-index: 100;
    }

    .tmx-col-head {
        padding: 10px 15px;
        font-family: sans-serif;
        font-weight: bold;
        text-transform: uppercase;
        font-size: 0.8rem;
        color: #8b0000;
        letter-spacing: 1px;
    }

    /* Rows */
    .tmx-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        border-bottom: 1px solid #eee;
    }

    .tmx-row:hover {
        background-color: #fffaf0;
    }

    /* Cells */
    .tmx-cell {
        padding: 15px;
        line-height: 1.6;
        font-size: 1rem;
        white-space: pre-wrap; /* Keeps line breaks from XML */
    }

    .tmx-cell.source {
        border-right: 1px solid #eee;
        color: #444;
    }
    
    .tmx-cell.target {
        color: #000;
    }

    /* Mobile */
    @media (max-width: 768px) {
        .tmx-header { display: none; }
        .tmx-row { display: flex; flex-direction: column; border-bottom: 4px solid #eee; }
        .tmx-cell.source { border-right: none; border-bottom: 1px dashed #ccc; color: #666; font-size: 0.9em; }
    }
</style>