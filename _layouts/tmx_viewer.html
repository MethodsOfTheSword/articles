---
layout: default
---
<article class="tmx-page">

    <div style="margin-bottom: 20px;">
        <a href="{{ '/' | relative_url }}" style="text-decoration: none; color: #8b0000;">&larr; Back to Archive</a>
    </div>

    <header style="margin-bottom: 40px; border-bottom: 1px solid #eee; padding-bottom: 20px;">
        <h1 style="margin-bottom: 10px;">{{ page.title }}</h1>
        <p style="color: #666; font-style: italic;">
            Parallel Text Viewer â€¢ TMX Source
        </p>

        <div style="margin-top: 15px;">
            <a href="{{ '/assets/sources/' | relative_url }}{{ page.tmx_filename }}" download style="
                background: #8b0000; 
                color: white; 
                padding: 8px 12px; 
                text-decoration: none; 
                border-radius: 4px; 
                font-size: 0.8rem; 
                text-transform: uppercase; 
                font-weight: bold;">
                ðŸ’¾ Download Raw TMX
            </a>
        </div>
    </header>

    <div id="loading-indicator" style="text-align: center; color: #888; padding: 50px;">
        Loading TMX data...
    </div>

    <div id="tmx-container" class="tmx-grid" style="display: none;">
        <div class="tmx-header">
            <div class="tmx-col-title">{{ page.source_label }}</div>
            <div class="tmx-col-title">{{ page.target_label }}</div>
        </div>
        </div>

    {% include version_links.html %}

</article>

<script>
document.addEventListener("DOMContentLoaded", function() {
    
    // 1. Config from Front Matter
    const tmxUrl = "{{ '/assets/sources/' | relative_url }}{{ page.tmx_filename }}";
    const srcCode = "{{ page.source_lang_code }}"; 
    const tgtCode = "{{ page.target_lang_code }}";

    console.log("Attempting to fetch TMX from:", tmxUrl); // DEBUG LOG

    fetch(tmxUrl)
        .then(response => {
            // Check if file exists (404 check)
            if (!response.ok) {
                throw new Error(`HTTP Error ${response.status}: File not found at ${tmxUrl}`);
            }
            return response.text();
        })
        .then(str => {
            // 2. Parse XML
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(str, "text/xml");
            
            // CHECK FOR PARSER ERRORS
            const parserError = xmlDoc.querySelector("parsererror");
            if (parserError) {
                console.error("Raw XML content that failed:", str.substring(0, 500) + "...");
                throw new Error("XML Parsing Failed. The file might be a 404 HTML page or contain invalid XML characters.");
            }

            // 3. Safe Access to Body
            const body = xmlDoc.getElementsByTagName("body")[0];
            if (!body) {
                console.error("XML Structure Dump:", xmlDoc);
                throw new Error("Valid XML found, but no <body> tag found. Check TMX structure.");
            }

            const tus = body.getElementsByTagName("tu");
            const grid = document.getElementById("tmx-grid");

            console.log(`Found ${tus.length} translation units.`); // DEBUG LOG

            // 4. Loop through Translation Units
            for (let i = 0; i < tus.length; i++) {
                let tu = tus[i];
                let tuvs = tu.getElementsByTagName("tuv");
                let srcText = "[Missing Source]";
                let tgtText = "";

                for (let j = 0; j < tuvs.length; j++) {
                    let lang = tuvs[j].getAttribute("xml:lang");
                    let seg = tuvs[j].getElementsByTagName("seg")[0];
                    let text = seg ? seg.textContent : "";

                    // Robust Language Matching (Case Insensitive & Partial)
                    // e.g., matches "it-IT" if code is "it"
                    if (lang && lang.toLowerCase().includes(srcCode.toLowerCase())) srcText = text;
                    if (lang && lang.toLowerCase().includes(tgtCode.toLowerCase())) tgtText = text;
                }

                let row = document.createElement("div");
                row.className = "tmx-row";
                row.innerHTML = `
                    <div class="tmx-cell source">${srcText}</div>
                    <div class="tmx-cell target">${tgtText}</div>
                `;
                grid.appendChild(row);
            }

            // 5. Success
            document.getElementById("loading-msg").style.display = "none";
            grid.style.display = "block"; // or flex
        })
        .catch(err => {
            console.error(err);
            const msgContainer = document.getElementById("loading-msg");
            msgContainer.style.color = "red";
            msgContainer.innerHTML = `
                <strong>Error Loading TMX:</strong><br>
                ${err.message}<br><br>
                <em>Open your browser console (F12) for details.</em>
            `;
        });
});
</script>

<style>
    .tmx-grid {
        display: flex;
        flex-direction: column;
        border-top: 2px solid #8b0000;
    }

    .tmx-header {
        display: grid;
        grid-template-columns: 1fr 1fr;
        position: sticky;
        top: 0;
        background: white;
        border-bottom: 1px solid #ccc;
        z-index: 10;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .tmx-col-title {
        padding: 10px 15px;
        font-weight: bold;
        text-transform: uppercase;
        font-size: 0.8rem;
        color: #8b0000;
        letter-spacing: 1px;
    }

    .tmx-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        border-bottom: 1px solid #eee;
        transition: background-color 0.2s;
    }

    .tmx-row:hover {
        background-color: #fffaf0;
    }

    .tmx-cell {
        padding: 15px;
        font-family: "Georgia", serif;
        line-height: 1.6;
        font-size: 1rem;
        white-space: pre-wrap; /* Preserves newlines in the XML */
    }

    .tmx-cell.source {
        border-right: 1px solid #eee;
        color: #444;
    }
    
    .tmx-cell.target {
        color: #000;
    }

    .segment-id {
        display: block;
        font-family: sans-serif;
        font-size: 0.6rem;
        color: #ccc;
        margin-bottom: 5px;
        user-select: none;
    }

    @media (max-width: 768px) {
        .tmx-header { display: none; }
        .tmx-row { display: flex; flex-direction: column; border-bottom: 4px solid #eee; }
        .tmx-cell.source { border-right: none; border-bottom: 1px dashed #ddd; }
    }
</style>